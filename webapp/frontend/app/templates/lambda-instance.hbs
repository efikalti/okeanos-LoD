<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Dashboard
    <small>Lambda Instance Details</small>
  </h1>
</section>

<!-- Main content -->
<section class="content">

  {{#if failure}}
      {{#each model.instance_action.errors as |error|}}
            <div  class="alert alert-dismissable alert-danger" id="alert">
              <button type="button" class="close" {{action "close_alert"}}>×</button>
              {{error.message}}
            </div>
      {{/each}}
  {{/if}}
  {{#if request}}
        <div  class="alert alert-dismissable alert-success" id="alert">
          <button type="button" class="close" {{action "close_alert"}}>×</button>
          {{message}}
        </div>
  {{/if}}

  <!-- TOP DATA -->
  <div class="row">
    <div class="col-xs-12">
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title"><i class="fa fa-laptop"></i> Lambda Instance Name: {{model.instance.name}}.</h3>
          <div class="box-tools pull-right">
            <small>ID:{{model.instance.id}}</small>
          </div>
        </div><!-- /.box-header -->
        <div class="box-body">
          <div class="row ">
            <div class="col-xs-12">

              <div class="pad">
              This page contains information regarding the lambda instance:<strong> {{model.instance.name}} </strong><br>
              You can view its details, <i>start, stop or delete</i> it.<br> In addition, you can browse the deployed application(s)
              onto this lambda instance and <i>deploy, start, stop or undeploy</i> them.<br> The visible buttons represent the available
              actions you may take depending on the <i>status</i> of the lambda instance.
              </div>

              <a href="delete-instance.html"  class="btn  btn-danger pull-right" style="margin-right: 15px;"><i class="fa fa-close"></i> Delete</a>
              {{#if (compare model.instance.status_code '==' '0')}}
                {{#link-to 'deploy-app-2' model.instance.id}}
                  <button class="btn btn-primary pull-right"
                          style="margin-right: 15px;"><i class="fa fa-mail-reply"> </i>
                      Deploy an application
                  </button>
                {{/link-to}}
              {{else}}
                <button class="btn btn-primary pull-right disabled"
                        style="margin-right: 15px;"><i class="fa fa-mail-reply"> </i>
                    Deploy an application
                </button>
              {{/if}}
                {{#if (compare model.instance.status_code '==' '0')}}
                  {{instance-action start=true disabled=true}}
                  {{instance-action apps=model.apps stop=true instance=model.instance_action failure=failure instance-id=model.instance.id request=request message=message action="start_stop"}}
                {{else if (compare model.instance.status_code '==' '1')}}
                  {{instance-action stop=true disabled=true}}
                  {{instance-action start=true instance=model.instance_action instance-id=model.instance.id failure=failure request=request message=message action="start_stop"}}
                {{else if (compare model.instance.status_code '==' '9')}}
                  {{instance-action start=true disabled=true}}
                  {{instance-action apps=model.apps stop=true instance=model.instance_action instance-id=model.instance.id failure=failure request=request message=message action="start_stop"}}
                {{else}}
                  {{instance-action start=true disabled=true}}
                  {{instance-action stop=true disabled=true}}
             {{/if}}
             </div>
          </div>
          <div class="row">
            <div class="col-md-9 col-sm-8">
              <div class="pad">
                Details of your lambda Instance.
              </div>
            </div><!-- /.col -->
          </div><!-- /.row -->

          <div class="row">
            <div class="col-ms-6 col-xs-5">
              <table  class="table table-bordered table-hover table-responsive">
                <thead>
                  <tr>
                    <th>Property</th>
                    <th>Value</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>Project name</th>
                    <td>{{model.instance.project_name}}</td>
                  </tr>
                  <tr>
                    <th>Number of slaves</th>
                    <td>{{model.instance.slaves}}</td>
                  </tr>
                  <tr>
                    <th>Name of master node</th>
                    <td>{{model.instance.master_name}}</td>
                  </tr>
                  <tr>
                    <th>Hostname of master node</th>
                    {{#if model.instance.master_node_id}}
                    <td>snf-{{model.instance.master_node_id}}.vm.okeanos.grnet.gr</td>
                    {{else}}
                    <td>-</td>
                    {{/if}}
                  </tr>
                  <tr>
                    <th>Number of master node cpus</th>
                    <td>{{model.instance.vcpus_master}}</td>
                  </tr>
                  <tr>
                    <th>Number of each slave node cpus</th>
                    <td>{{model.instance.vcpus_slave}}</td>
                  </tr>
                  <tr>
                    <th>Size of master node RAM</th>
                    <td>{{model.instance.ram_master}}MB</td>
                  </tr>
                  <tr>
                    <th>Size of each slave node RAM</th>
                    <td>{{model.instance.ram_slave}}MB</td>
                  </tr>
                  <tr>
                    <th>Size of master node HDD</th>
                    <td>{{model.instance.disk_master}}GB</td>
                  </tr>
                  <tr>
                    <th>Size of each slave node HDD</th>
                    <td>{{model.instance.disk_slave}}GB</td>
                  </tr>
                  {{#if lambda-instance.public_key_name}}
                  <tr>
                    <th>Authorized public keys</th>
                    <td>{{lambda-instance.public_key_name}}</td>
                  </tr>
                  {{/if}}
                  <tr>
                    <th>Instance status message</th>
                    <td>{{model.instance.status_message}}</td>
                  </tr>
                  <tr>
                    <th>Instance status details</th>
                    <td>{{model.instance.status_detail}}</td>
                  </tr>
                  {{#if lambda-instance.status_failure_message}}
                  <tr>
                    <th>Instance failure message</th>
                    <td>{{lambda-instance.status_failure_message}}</td>
                  </tr>
                  {{/if}}
                </tbody>
              </table>
            </div><!--col-xs-12-->
          </div><!--row-->
        </div><!--box-->
      </div> <!-- box-primary -->
    </div> <!--col -->
  </div> <!--row-->
  {{#if (compare model.apps.length "!==" 0)}}

{{#if app_failure}}
    {{#each model.app.errors as |error|}}
          <div  class="alert alert-dismissable alert-danger" id="alert">
            <button type="button" class="close" {{action "close_alert"}}>×</button>
            {{error.message}}
          </div>
    {{/each}}
{{/if}}

  {{#if app_request}}
        <div  class="alert alert-dismissable alert-success" id="alert">
          <button type="button" class="close" {{action "close_alert"}}>×</button>
          {{message}}
        </div>
  {{/if}}

  <div class="row">
    <div class="col-xs-12">
      <div class="box box-warning">
        <div class="box-header with-border">
          <h3 class="box-title"><i class="fa fa-th"></i> Applications deployed on this Lambda Instance</h3>
        </div><!-- /.box-header -->
        <div class="box-body">
          <div class=“row”>
            <div class="col-xs-12">
              These are the Applications that are currently deployed on the current Lambda Instance.
            </div>
          </div>
          <div class=“row”>
            <div class="col-ms-8 col-xs-8">
              <table class="table table-bordered table-hover table-responsive">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Started</th>
                    <th> Actions </th>
                  </tr>
                </thead>
                <tbody>
                  {{#each model.apps as |application|}}
                  <tr class="instance-info">
                    <td>
                      {{#link-to 'lambda-app' application.id tooltipContent=application.id}}
                        {{application.name}}
                      {{/link-to}}
                    </td>
                    <td>{{lower-case application.app_type}}</td>
                    <td>{{application.started}}</td>
                    <td>
                      <div class="table">
                          <table class="table">
                              <tbody>
                                {{#if (compare model.instance.status_code '==' '0')}}
                                    {{#if application.started}}
                                        <td>
                                          {{app-action stop=true app=model.app application-id=application.id instance-id=model.instance.id request=app_request failure=app_failure message=message action="start_stop"}}
                                        </td>
                                        <td>
                                          {{app-action start=true disabled=true}}
                                        </td>
                                        <td>
                                          {{app-action withdraw=true disabled=true}}
                                        </td>
                                    {{else}}
                                      <td>
                                        {{app-action stop=true disabled=true}}
                                      </td>
                                        <td>
                                          {{app-action start=true app=model.app application-id=application.id instance-id=model.instance.id request=app_request failure=app_failure message=message action="start_stop"}}
                                        </td>
                                        <td>
                                          {{app-action withdraw=true app=model.app application-id=application.id instance-id=model.instance.id request=app_request failure=app_failure message=message action="withdraw"}}
                                        </td>
                                      {{/if}}
                                    {{else}}
                                        <td>
                                          {{app-action stop=true disabled=true}}
                                        </td>
                                        <td>
                                          {{app-action start=true disabled=true}}
                                        </td>
                                        <td>
                                          {{app-action withdraw=true disabled=true}}
                                        </td>
                                    {{/if}}
                              </tbody>
                          </table>
                      </div>
                  </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div><!--class="table-responsive"-->
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div>
    </div>
  </div>
  {{/if}}
</section><!-- /.content -->
